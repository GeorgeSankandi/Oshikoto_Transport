<div class="container-fluid" style="padding: 0;">
    <!-- Navigation (Hidden on Print) -->
    <div class="d-flex justify-content-between align-items-center mb-3 p-3 no-print" style="max-width: 1000px; margin: 0 auto;">
        <a href="/dashboard" class="btn btn-secondary">&larr; Back to Dashboard</a>
        <h4 class="text-primary m-0">
            {{#if isEditMode}}Edit Checklist{{else}}New Checklist{{/if}}
            <small class="text-muted" style="font-size: 0.7em;"> - {{booking.service.title}}</small>
        </h4>
    </div>

    <!-- MAIN FORM CONTAINER -->
    <form id="checklistForm" action="/dashboard/checklist/{{booking._id}}" method="POST">
        
        <!-- ========================================= -->
        <!-- === INLINE CSS (Strictly from Source) === -->
        <!-- ========================================= -->
        <style>
            :root {
                --primary-border-color: black;
                --header-bg: #e0e0e0;
                --section-bg: #e6e6e6;
                
                /* Typography */
                --font-size-base: 14px;
                --font-size-small: 12px;
                --font-size-tiny: 10px; /* New for 188px screens */

                /* Backgrounds */
                --background-color-base: #64B298;
                --background-image-url: url('/images/pattern.png');
                --gradient-overlay: linear-gradient(to bottom, #64B298 0%, #A3CE74 100%);
            }

            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 5px; /* Reduced padding */
                min-width: 188px; /* Enforce minimum width */
                background-color: var(--background-color-base);
                background-image: var(--gradient-overlay);
                background-repeat: repeat;
                background-attachment: fixed;
                background-size: auto, cover;
                background-position: center center;
            }

            #checklistForm {
                max-width: 1000px;
                width: 100%;
                margin: 0 auto;
                background-color: #fff; /* Ensure white background for form */
                padding: 5px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                border: 1px solid var(--primary-border-color);
                box-sizing: border-box;
            }

            /* === Force White Backgrounds === */
            .checklist-title, .header-grid, .info-grid, .instructions, 
            .checklist-table th, .section-header td, .other-checks p, 
            .signature-table, .header-col-1, .header-col-2, .header-col-3, 
            .info-cell, .checklist-table td, .remarks-section {
                background-color: white !important;
            }

            /* === Header Grid (1 Column default) === */
            .header-grid {
                display: grid;
                grid-template-columns: 1fr;
                border: 1px solid var(--primary-border-color);
                margin-bottom: 5px;
                font-size: var(--font-size-small);
            }
            .header-col-1, .header-col-2, .header-col-3 {
                border-bottom: 1px solid var(--primary-border-color);
                padding: 5px;
            }
            .header-col-3 { border-bottom: none; text-align: center; }
            .logo-box img { max-width: 100%; height: auto; }

            /* === Title === */
            .checklist-title {
                text-align: center;
                background-color: var(--header-bg) !important;
                padding: 5px;
                border: 1px solid var(--primary-border-color);
                border-top: none;
                margin-top: 0;
                font-size: 1rem;
            }

            /* === Info Grid (1 Column default) === */
            .info-grid {
                display: grid;
                grid-template-columns: 1fr;
                border: 1px solid var(--primary-border-color);
                border-bottom: none;
            }
            .info-cell {
                border-bottom: 1px solid var(--primary-border-color);
                padding: 5px;
                font-size: var(--font-size-small);
                display: flex;
                flex-direction: column;
            }
            .info-cell input {
                width: 100%;
                box-sizing: border-box;
                margin-top: 2px;
                border: none;
                background: white;
                font-size: var(--font-size-tiny);
            }

            /* === Shift Toggle (Vertical default for small screens) === */
            .shift-group-wrapper {
                grid-column: span 1;
                padding: 5px;
                border-right: none !important;
            }
            .shift-toggle-group {
                display: flex;
                flex-direction: column; /* Stack vertically on mobile */
                width: 100%;
                border: 1px solid var(--primary-border-color);
                border-radius: 4px;
                overflow: hidden;
            }
            .shift-toggle-group label {
                flex-grow: 1;
                text-align: center;
                cursor: pointer;
                border-bottom: 1px solid #ccc;
                margin-bottom: 0;
            }
            .shift-toggle-group label:last-child { border-bottom: none; }
            .shift-toggle-group input { display: none; }
            .shift-toggle-group label span {
                display: block;
                padding: 5px;
                background: #f9f9f9;
                font-size: var(--font-size-tiny);
            }
            .shift-toggle-group input:checked + span {
                background-color: #007bff;
                color: white;
                font-weight: bold;
            }

            /* === Instructions === */
            .instructions {
                border: 1px solid var(--primary-border-color);
                border-top: none;
                padding: 5px;
                font-size: var(--font-size-small);
            }
            .instructions p { margin: 2px 0; }

            /* === Table Layout (Desktop View - Default Structure) === */
            .checklist-container {
                display: flex;
                flex-direction: column; /* Stack tables on mobile */
                gap: 10px;
            }
            .table-wrapper { width: 100%; }

            .checklist-table {
                width: 100%;
                border: 1px solid var(--primary-border-color);
                font-size: var(--font-size-small);
                table-layout: fixed; /* Fixed layout for consistent column widths */
                border-collapse: collapse;
            }

            .checklist-table th, .checklist-table td {
                border: 1px solid var(--primary-border-color);
                padding: 4px;
                text-align: left;
            }
            .checklist-table th {
                background-color: #f0f0f0 !important;
                text-align: center;
                font-size: var(--font-size-tiny);
            }

            /* Column widths - Adjusted for 4 columns total */
            .col-desc { width: 45%; } 
            .col-class { width: 10%; text-align: center; }
            .col-switch { width: 25%; } /* Dep switch */
            .col-dep-ref { width: 10%; } /* Dep Ref */
            .col-arr { width: 10%; } /* Arr Time */

            /* === Switch Styling === */
            .switch-cell {
                position: relative;
                min-height: 30px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .toggle-switch.three-state {
                width: 100%;
                display: block;
            }
            .switch-control {
                position: relative;
                width: 100px; /* Default width */
                height: 24px;
                margin: 0 auto;
            }
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0; left: 0; right: 0; bottom: 0;
                background-color: #ccc;
                transition: .4s;
                border-radius: 12px;
            }
            .slider:before {
                position: absolute;
                content: "";
                height: 18px; width: 18px;
                left: 3px; bottom: 3px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }
            .status-input { opacity: 0; width: 0; height: 0; }
            .status-ok-input:checked ~ .slider { background-color: #4CAF50; } 
            .status-ok-input:checked ~ .slider:before { transform: translateX(0); }
            .status-na-input:checked ~ .slider { background-color: #ccc; }
            .status-na-input:checked ~ .slider:before { transform: translateX(38px); } /* Middle */
            .status-def-input:checked ~ .slider { background-color: #f44336; }
            .status-def-input:checked ~ .slider:before { transform: translateX(76px); } /* Right */

            /* Notification */
            .unselected-notification {
                display: block;
                color: #6c757d;
                font-size: 10px;
                font-style: italic;
                margin-top: 2px;
                opacity: 0;
                transition: opacity 0.2s;
            }

            /* === Inputs === */
            .checklist-table input[type="text"],
            .checklist-table input[type="time"],
            .department-ref-input {
                width: 100%;
                border: none;
                background: white;
                font-size: var(--font-size-tiny);
                box-sizing: border-box;
            }
            .department-ref-input { background-color: #f7f7f7 !important; }

            /* === Other & Remarks === */
            .other-checks { border: 1px solid var(--primary-border-color); margin-bottom: 5px; }
            .other-checks p { background-color: var(--section-bg) !important; padding: 5px; margin: 0; }
            .other-checks table { width: 100%; border-collapse: collapse; }
            .other-checks td { border: 1px solid black; }
            .other-desc { width: 70%; padding: 5px; font-size: var(--font-size-small); }
            .y-n-switch-cell { width: 30%; text-align: center; position: relative; }

            .remarks-section {
                border: 1px solid var(--primary-border-color);
                padding: 5px;
                font-size: var(--font-size-small);
            }
            .remarks-section textarea { width: 100%; box-sizing: border-box; min-height: 60px; border: 1px solid #ccc; }

            .signature-line {
                display: flex; flex-direction: column; gap: 5px; margin-top: 5px;
            }
            .signature-line p { display: flex; align-items: center; margin: 0; }
            .signature-line input { margin-left: 5px; border: none; border-bottom: 1px dotted black; flex-grow: 1; }

            /* === Page 2 Signatures === */
            .signature-area { margin-top: 20px; border: 1px solid var(--primary-border-color); padding: 5px; }
            .signature-table { width: 100%; border: none; }
            .signature-table td { display: block; width: 100%; border: none; padding: 5px 0; }
            .signature-table input { width: 100%; border-bottom: 1px dotted black; border-top: none; border-left: none; border-right: none; }

            .submit-section { text-align: center; margin-top: 20px; padding-bottom: 20px; }
            .submit-section button {
                padding: 10px 20px;
                font-size: 16px;
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            
            .no-print {
                @media print { display: none !important; }
            }

            /* ========================================================= */
            /* RESPONSIVE MEDIA QUERIES */
            /* ========================================================= */

            /* Tablet (min 500px) */
            @media (min-width: 500px) {
                .checklist-container { flex-direction: row; }
                .table-wrapper { width: 49%; }
                .info-grid { grid-template-columns: 1fr 1fr; }
                .signature-table td { display: table-cell; width: 50%; }
                .signature-line { flex-direction: row; }
                .signature-line p { width: 48%; }
                .switch-control { width: 120px; }
                /* Recalculate slider positions for 120px width */
                .status-na-input:checked ~ .slider:before { transform: translateX(50px); }
                .status-def-input:checked ~ .slider:before { transform: translateX(98px); }
            }

            /* Desktop (min 768px) */
            @media (min-width: 768px) {
                .header-grid { grid-template-columns: 2fr 1fr 1fr; }
                .header-col-1, .header-col-2 { border-right: 1px solid #000; border-bottom: none; }
                .header-col-3 { border-left: 1px solid #000; border-right: none; }
                .info-grid { grid-template-columns: repeat(4, 1fr); }
                .shift-group-wrapper { grid-column: span 4; }
                .checklist-table { table-layout: fixed; }
            }

            /* ========================================================= */
            /* ULTRA-SMALL SCREENS (< 400px) */
            /* ========================================================= */
            @media (max-width: 400px) {
                .checklist-container { flex-direction: column; }
                .table-wrapper { width: 100%; }
                .checklist-table, .checklist-table thead, .checklist-table tbody, .checklist-table tr, .checklist-table td {
                    display: block; width: 100%; box-sizing: border-box;
                }
                .checklist-table thead { display: none; }
                .checklist-table tbody tr {
                    margin-bottom: 10px; border: 1px solid #000; background-color: white; padding: 5px; position: relative;
                }
                .section-header td {
                    background-color: var(--section-bg) !important; font-weight: bold; text-align: center; border-bottom: 2px solid #000; padding: 8px;
                }
                .checklist-table tbody td {
                    padding: 5px 0; border-bottom: 1px solid #eee; text-align: left; border-top: none; border-left: none; border-right: none;
                }
                .checklist-table tbody td:first-child {
                    font-weight: bold; font-size: var(--font-size-small); background-color: #f9f9f9; padding: 5px; border-bottom: 2px solid #ddd;
                }
                .col-class { display: none; }
                .switch-cell { min-height: 40px; }
                .toggle-switch.three-state { width: 100%; }
                .switch-control { width: 90%; height: 30px; }
                .slider { border-radius: 15px; }
                .slider:before { height: 24px; width: 24px; left: 3px; bottom: 3px; }
                .status-na-input:checked ~ .slider:before { transform: translateX(58px); }
                .status-def-input:checked ~ .slider:before { transform: translateX(113px); }
                input[type="text"] { height: 30px; font-size: 14px; padding: 2px; }
                .header-grid { grid-template-columns: 1fr; }
                .shift-toggle-group { flex-direction: column; }
                .shift-toggle-group label span { font-size: 12px; }
                .other-checks table { display: block; }
                .other-checks tr { display: flex; flex-direction: column; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
                .other-desc, .y-n-switch-cell { width: 100%; text-align: left; border: none; }
            }
        </style>

        <header class="header-grid">
            <div class="header-col-1">
                <p><strong>Company Name:</strong><br>Oshikoto Transport & Investment CC</p>
                <p><strong>Document Type:</strong><br>Health, Safety & Environmental Checklist</p>
            </div>
            <div class="header-col-2">
                <p><strong>Document No./Saved As:</strong> C002</p>
                <p><strong>Revision Number:</strong> 01</p>
                <p><strong>Page:</strong> Page 1 of 2</p>
            </div>
            <div class="header-col-3">
                <div class="logo-box">
                    <img src="/images/companylogo.png" alt="Logo" style="max-height: 50px;">
                </div>
            </div>
        </header>

        <h1 class="checklist-title">Daily Fleet Pre-Departure Checklist</h1>

        <div class="info-grid">
            <div class="info-cell"><strong>Date</strong><input type="date" name="date" value="{{checklist.formData.date}}"></div>
            <div class="info-cell"><strong>Department / Branch</strong><input type="text" name="department" id="mainDepartmentInput" value="{{checklist.formData.department}}"></div>
            <div class="info-cell"><strong>Registration No</strong><input type="text" name="registrationNo" value="{{checklist.formData.registrationNo}}"></div>
            <div class="info-cell"><strong>Odometer Reading</strong><input type="number" name="odometerReading" value="{{checklist.formData.odometerReading}}"></div>
            <div class="info-cell"><strong>Route</strong><input type="text" name="route" value="{{checklist.formData.route}}"></div>
            <div class="info-cell"><strong>Seats Occupied</strong><input type="number" name="seatsOccupied" value="{{checklist.formData.seatsOccupied}}"></div>
            <div class="info-cell route-cell"><strong>To site</strong><input type="text" name="toSite" value="{{checklist.formData.toSite}}"></div>
            <div class="info-cell route-cell"><strong>Return</strong><input type="text" name="return" value="{{checklist.formData.return}}"></div>
            
            <div class="info-cell shift-group-wrapper" style="grid-column: span 4;">
                <strong>Shift</strong>
                <div class="shift-toggle-group">
                    <label>
                        <input type="radio" name="shift" value="Morning Shifts" required>
                        <span>Morning Shifts</span>
                    </label>
                    <label>
                        <input type="radio" name="shift" value="Afternoon Shift">
                        <span>Afternoon Shift</span>
                    </label>
                    <label>
                        <input type="radio" name="shift" value="8 to 8 Shift">
                        <span>8 to 8 Shift</span>
                    </label>
                    <label>
                        <input type="radio" name="shift" value="Night Shift">
                        <span>Night Shift</span>
                    </label>
                </div>
            </div>
        </div>

        <div class="instructions">
            <p>* If item is in order, please mark with a "OK"</p>
            <p>* If there is a problem with an item, please mark - **DEF** (class A machine is not operated until fix / class B To be rectified at next daily service)</p>
            <p>* Mark Fire Extinguisher and First Aid Kit area with (**Y/N**)</p>
        </div>

        <div class="checklist-container">
            <!-- Table 1: External Checks (Left Column) -->
            <table class="checklist-table">
                <thead>
                    <tr>
                        <th>Description</th> 
                        <th class="col-class">Class</th> 
                        <th class="col-c-switch" colspan="2">Dep.</th>
                        <th class="col-dep">Dep. Ref</th> 
                        <th class="col-arr">Arr.</th>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr class="section-header"><td colspan="7"><strong>External Checks:</strong></td></tr>
                    
                    <tr data-item="Brake Fluid">
                        <td>Brake Fluid</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Brake_Fluid">
                                <div class="switch-control">
                                    <input type="radio" name="Brake_Fluid" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Brake_Fluid" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Brake_Fluid" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Brake_Fluid_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Brake_Fluid_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Window Washer Fluid">
                        <td>Window Washer Fluid</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Window_Washer_Fluid">
                                <div class="switch-control">
                                    <input type="radio" name="Window_Washer_Fluid" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Window_Washer_Fluid" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Window_Washer_Fluid" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Window_Washer_Fluid_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Window_Washer_Fluid_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Door Handles">
                        <td>Door Handles</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Door_Handles">
                                <div class="switch-control">
                                    <input type="radio" name="Door_Handles" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Door_Handles" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Door_Handles" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Door_Handles_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Door_Handles_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="License valid">
                        <td>License valid</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="License_valid">
                                <div class="switch-control">
                                    <input type="radio" name="License_valid" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="License_valid" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="License_valid" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="License_valid_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="License_valid_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Branding Intact">
                        <td>Branding Intact</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Branding_Intact">
                                <div class="switch-control">
                                    <input type="radio" name="Branding_Intact" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Branding_Intact" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Branding_Intact" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Branding_Intact_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Branding_Intact_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Lights - Brake Lights">
                        <td>Lights - Brake Lights</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Lights_Brake_Lights">
                                <div class="switch-control">
                                    <input type="radio" name="Lights_Brake_Lights" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Lights_Brake_Lights" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Lights_Brake_Lights" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Lights_Brake_Lights_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Lights_Brake_Lights_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Lights - Brights / Dimmed" class="sub-item">
                        <td class="sub-col">&nbsp;- Brights / Dimmed</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Lights_Brights_Dimmed">
                                <div class="switch-control">
                                    <input type="radio" name="Lights_Brights_Dimmed" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Lights_Brights_Dimmed" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Lights_Brights_Dimmed" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Lights_Brights_Dimmed_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Lights_Brights_Dimmed_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Lights - Indicators" class="sub-item">
                        <td class="sub-col">&nbsp;- Indicators</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Lights_Indicators">
                                <div class="switch-control">
                                    <input type="radio" name="Lights_Indicators" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Lights_Indicators" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Lights_Indicators" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Lights_Indicators_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Lights_Indicators_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Lights - Reverse Lights" class="sub-item">
                        <td class="sub-col">&nbsp;- Reverse Lights</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Lights_Reverse_Lights">
                                <div class="switch-control">
                                    <input type="radio" name="Lights_Reverse_Lights" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Lights_Reverse_Lights" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Lights_Reverse_Lights" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Lights_Reverse_Lights_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Lights_Reverse_Lights_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Lights - Room lights" class="sub-item">
                        <td class="sub-col">&nbsp;- Room lights</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Lights_Room_lights_Ext">
                                <div class="switch-control">
                                    <input type="radio" name="Lights_Room_lights_Ext" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Lights_Room_lights_Ext" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Lights_Room_lights_Ext" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Lights_Room_lights_Ext_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Lights_Room_lights_Ext_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Fog light">
                        <td>Fog light</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Fog_light">
                                <div class="switch-control">
                                    <input type="radio" name="Fog_light" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Fog_light" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Fog_light" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Fog_light_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Fog_light_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Oil Leaks">
                        <td>Oil Leaks</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Oil_Leaks">
                                <div class="switch-control">
                                    <input type="radio" name="Oil_Leaks" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Oil_Leaks" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Oil_Leaks" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Oil_Leaks_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Oil_Leaks_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Oil Level">
                        <td>Oil Level</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Oil_Level">
                                <div class="switch-control">
                                    <input type="radio" name="Oil_Level" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Oil_Level" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Oil_Level" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Oil_Level_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Oil_Level_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Spare Wheel">
                        <td>Spare Wheel</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Spare_Wheel">
                                <div class="switch-control">
                                    <input type="radio" name="Spare_Wheel" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Spare_Wheel" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Spare_Wheel" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Spare_Wheel_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Spare_Wheel_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Tire Tread">
                        <td>Tire Tread</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Tire_Tread">
                                <div class="switch-control">
                                    <input type="radio" name="Tire_Tread" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Tire_Tread" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Tire_Tread" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Tire_Tread_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Tire_Tread_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Power steering fluid">
                        <td>Power steering fluid</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Power_steering_fluid">
                                <div class="switch-control">
                                    <input type="radio" name="Power_steering_fluid" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Power_steering_fluid" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Power_steering_fluid" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Power_steering_fluid_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Power_steering_fluid_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Water Leaks">
                        <td>Water Leaks</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Water_Leaks">
                                <div class="switch-control">
                                    <input type="radio" name="Water_Leaks" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Water_Leaks" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Water_Leaks" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Water_Leaks_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Water_Leaks_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Wheel Nuts">
                        <td>Wheel Nuts</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Wheel_Nuts">
                                <div class="switch-control">
                                    <input type="radio" name="Wheel_Nuts" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Wheel_Nuts" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Wheel_Nuts" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Wheel_Nuts_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Wheel_Nuts_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Windows (cracked / chipped)">
                        <td>Windows (cracked / chipped)</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Windows">
                                <div class="switch-control">
                                    <input type="radio" name="Windows" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Windows" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Windows" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Windows_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Windows_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Wiper Blades">
                        <td>Wiper Blades</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Wiper_Blades">
                                <div class="switch-control">
                                    <input type="radio" name="Wiper_Blades" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Wiper_Blades" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Wiper_Blades" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Wiper_Blades_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Wiper_Blades_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Triangles (x2)">
                        <td>Triangles (x2) [in case of breakdown]</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Triangles">
                                <div class="switch-control">
                                    <input type="radio" name="Triangles" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Triangles" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Triangles" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Triangles_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Triangles_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Jack">
                        <td>Jack</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Jack">
                                <div class="switch-control">
                                    <input type="radio" name="Jack" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Jack" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Jack" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Jack_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Jack_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Reflective Jacket">
                        <td>Reflective Jacket (in case of breakdown - optional)</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Reflective_Jacket">
                                <div class="switch-control">
                                    <input type="radio" name="Reflective_Jacket" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Reflective_Jacket" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Reflective_Jacket" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Reflective_Jacket_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Reflective_Jacket_Arr"></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>

            <!-- Table 2: External Checks (Right Column) and Internal Checks -->
            <table class="checklist-table">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th class="col-class">Class</th>
                        <th class="col-switch" colspan="2">Dep.</th>
                        <th class="col-dep">Dep. Ref</th>
                        <th class="col-arr">Arr.</th>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr class="section-header"><td colspan="7"><strong>External (cont.) & Internal:</strong></td></tr>
                    
                    <tr data-item="Camera working">
                        <td>Camera working</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Camera_working">
                                <div class="switch-control">
                                    <input type="radio" name="Camera_working" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Camera_working" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Camera_working" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Camera_working_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Camera_working_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Service brake">
                        <td>Service brake</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Service_brake">
                                <div class="switch-control">
                                    <input type="radio" name="Service_brake" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Service_brake" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Service_brake" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Service_brake_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Service_brake_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Toolbox">
                        <td>Toolbox</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Toolbox">
                                <div class="switch-control">
                                    <input type="radio" name="Toolbox" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Toolbox" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Toolbox" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Toolbox_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Toolbox_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Spare spanners">
                        <td>Spare spanners</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Spare_spanners">
                                <div class="switch-control">
                                    <input type="radio" name="Spare_spanners" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Spare_spanners" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Spare_spanners" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Spare_spanners_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Spare_spanners_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Wheel spanner">
                        <td>Wheel spanner</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Wheel_spanner">
                                <div class="switch-control">
                                    <input type="radio" name="Wheel_spanner" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Wheel_spanner" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Wheel_spanner" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Wheel_spanner_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Wheel_spanner_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="100 km sticker">
                        <td>100 km sticker</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="100_km_sticker">
                                <div class="switch-control">
                                    <input type="radio" name="100_km_sticker" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="100_km_sticker" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="100_km_sticker" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="100_km_sticker_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="100_km_sticker_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Log book (MDC)">
                        <td>Log book (MDC)</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Log_book">
                                <div class="switch-control">
                                    <input type="radio" name="Log_book" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Log_book" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Log_book" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Log_book_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Log_book_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Air leaks">
                        <td>Air leaks</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Air_leaks">
                                <div class="switch-control">
                                    <input type="radio" name="Air_leaks" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Air_leaks" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Air_leaks" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Air_leaks_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Air_leaks_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Stop blocks">
                        <td>Stop blocks</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Stop_blocks">
                                <div class="switch-control">
                                    <input type="radio" name="Stop_blocks" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Stop_blocks" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Stop_blocks" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Stop_blocks_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Stop_blocks_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Fleet numbers">
                        <td>Fleet numbers</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Fleet_numbers">
                                <div class="switch-control">
                                    <input type="radio" name="Fleet_numbers" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Fleet_numbers" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Fleet_numbers" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Fleet_numbers_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Fleet_numbers_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Valid public permit">
                        <td>Valid public permit</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Valid_public_permit">
                                <div class="switch-control">
                                    <input type="radio" name="Valid_public_permit" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Valid_public_permit" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Valid_public_permit" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Valid_public_permit_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Valid_public_permit_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Revers hooter">
                        <td>Revers hooter</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Revers_hooter">
                                <div class="switch-control">
                                    <input type="radio" name="Revers_hooter" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Revers_hooter" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Revers_hooter" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Revers_hooter_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Revers_hooter_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Reflector strips">
                        <td>Reflector strips</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Reflector_strips">
                                <div class="switch-control">
                                    <input type="radio" name="Reflector_strips" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Reflector_strips" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Reflector_strips" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Reflector_strips_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Reflector_strips_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Park brake">
                        <td>Park brake</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Park_brake">
                                <div class="switch-control">
                                    <input type="radio" name="Park_brake" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Park_brake" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Park_brake" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Park_brake_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Park_brake_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Emergency brake">
                        <td>Emergency brake</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Emergency_brake">
                                <div class="switch-control">
                                    <input type="radio" name="Emergency_brake" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Emergency_brake" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Emergency_brake" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Emergency_brake_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Emergency_brake_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Diesel leaks">
                        <td>Diesel leaks</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Diesel_leaks">
                                <div class="switch-control">
                                    <input type="radio" name="Diesel_leaks" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Diesel_leaks" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Diesel_leaks" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Diesel_leaks_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Diesel_leaks_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Exhaust leaks">
                        <td>Exhaust leaks</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Exhaust_leaks">
                                <div class="switch-control">
                                    <input type="radio" name="Exhaust_leaks" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Exhaust_leaks" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Exhaust_leaks" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Exhaust_leaks_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Exhaust_leaks_Arr"></td>
                        <td></td>
                    </tr>
                    
                    <tr class="section-header"><td colspan="7"><strong>Internal Checks:</strong></td></tr>
                    
                    <tr data-item="Warning Lights">
                        <td>Warning Lights</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Warning_Lights">
                                <div class="switch-control">
                                    <input type="radio" name="Warning_Lights" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Warning_Lights" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Warning_Lights" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Warning_Lights_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Warning_Lights_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Heat Guage">
                        <td>Heat Guage</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Heat_Guage">
                                <div class="switch-control">
                                    <input type="radio" name="Heat_Guage" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Heat_Guage" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Heat_Guage" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Heat_Guage_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Heat_Guage_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Hooter">
                        <td>Hooter</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Hooter">
                                <div class="switch-control">
                                    <input type="radio" name="Hooter" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Hooter" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Hooter" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Hooter_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Hooter_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Seats & Seat Belts">
                        <td>Seats & Seat Belts</td>
                        <td class="col-class">A</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Seats_Seat_Belts">
                                <div class="switch-control">
                                    <input type="radio" name="Seats_Seat_Belts" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Seats_Seat_Belts" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Seats_Seat_Belts" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Seats_Seat_Belts_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Seats_Seat_Belts_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Mirrors (rear & side)">
                        <td>Mirrors (rear & side)</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Mirrors">
                                <div class="switch-control">
                                    <input type="radio" name="Mirrors" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Mirrors" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Mirrors" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Mirrors_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Mirrors_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Room Lights">
                        <td>Room Lights</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Room_Lights_Int">
                                <div class="switch-control">
                                    <input type="radio" name="Room_Lights_Int" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Room_Lights_Int" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Room_Lights_Int" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Room_Lights_Int_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Room_Lights_Int_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Fuel level (%)">
                        <td>Fuel level (%)</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Fuel_level">
                                <div class="switch-control">
                                    <input type="radio" name="Fuel_level" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Fuel_level" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Fuel_level" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Fuel_level_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Fuel_level_Arr"></td>
                        <td></td>
                    </tr>
                    <tr data-item="Fuel tag">
                        <td>Fuel tag</td>
                        <td class="col-class">B</td>
                        <td class="switch-cell" colspan="2">
                            <div class="toggle-switch three-state" data-name="Fuel_tag">
                                <div class="switch-control">
                                    <input type="radio" name="Fuel_tag" value="OK" class="status-input status-ok-input">
                                    <input type="radio" name="Fuel_tag" value="N/A" class="status-input status-na-input">
                                    <input type="radio" name="Fuel_tag" value="DEF" class="status-input status-def-input">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <span class="unselected-notification">N/A</span>
                        </td>
                        <td><input type="text" name="Fuel_tag_Dep_Ref" class="department-ref-input" readonly></td>
                        <td><input type="time" name="Fuel_tag_Arr"></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="other-checks">
            <p><strong>Other:</strong></p>
            <table>
                <tr>
                    <td class="other-desc">Fire Extinguisher available?</td>
                    <td class="y-n-switch-cell" colspan="2">
                         <div class="toggle-switch three-state y-n-switch" data-name="Fire_Extinguisher">
                            <div class="switch-control">
                                <input type="radio" name="Fire_Extinguisher" value="Y" class="status-input status-ok-input">
                                <input type="radio" name="Fire_Extinguisher" value="N/A" class="status-input status-na-input">
                                <input type="radio" name="Fire_Extinguisher" value="N" class="status-input status-def-input">
                                <span class="slider"></span>
                            </div>
                        </div>
                        <span class="unselected-notification">N/A</span>
                    </td>
                </tr>
                <tr>
                    <td class="other-desc">First aid kit available?</td>
                    <td class="y-n-switch-cell" colspan="2">
                         <div class="toggle-switch three-state y-n-switch" data-name="First_Aid_Kit">
                            <div class="switch-control">
                                <input type="radio" name="First_Aid_Kit" value="Y" class="status-input status-ok-input">
                                <input type="radio" name="First_Aid_Kit" value="N/A" class="status-input status-na-input">
                                <input type="radio" name="First_Aid_Kit" value="N" class="status-input status-def-input">
                                <span class="slider"></span>
                            </div>
                        </div>
                        <span class="unselected-notification">N/A</span>
                    </td>
                </tr>
            </table>
        </div>

        <div class="remarks-section">
            <p><strong>REPAIRS OR REMARKS DURING SHIFT</strong></p>
            <textarea name="remarks" rows="3">{{checklist.formData.remarks}}</textarea>
            <div class="signature-line">
                <p>TIME <input type="time" name="remarks_time" value="{{checklist.formData.remarks_time}}"></p>
                <p>SIGNATURE <input type="text" name="remarks_signature" value="{{checklist.formData.remarks_signature}}"></p>
            </div>
        </div>

        <div class="signature-area page-2">
            <table class="signature-table">
                <tr>
                    <td><strong>DRIVER NAME</strong><input type="text" name="driverName" value="{{checklist.formData.driverName}}"></td>
                    <td><strong>DRIVERS SIGNATURE</strong><input type="text" name="driverSignature" value="{{checklist.formData.driverSignature}}"></td>
                </tr>
                <tr>
                    <td><strong>SUPERVISOR NAME</strong><input type="text" name="supervisorName" value="{{checklist.formData.supervisorName}}"></td>
                    <td><strong>SUPERVISOR SIGNATURE</strong><input type="text" name="supervisorSignature" value="{{checklist.formData.supervisorSignature}}"></td>
                </tr>
            </table>
        </div>

        <div class="submit-section">
            <button type="submit">Submit Checklist</button>
            <p id="message-area"></p>
        </div>
    </form>

    <!-- ============================================== -->
    <!-- === JAVASCRIPT LOGIC (Strictly Applied)    === -->
    <!-- ============================================== -->
    <script>
        window.savedFormData = {{{json checklist.formData}}};
        if(!window.savedFormData) window.savedFormData = {};
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('checklistForm');
        const dateInput = form.querySelector('input[name="date"]');
        const mainDepartmentInput = document.getElementById('mainDepartmentInput');
        const departmentRefInputs = document.querySelectorAll('.department-ref-input');
        const messageArea = document.getElementById('message-area');

        // 1. Auto-fill Date with current date
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        if (!dateInput.value) {
            dateInput.value = `${yyyy}-${mm}-${dd}`;
        }

        // --- Department Synchronization Logic ---
        const syncDepartmentFields = () => {
            const departmentValue = mainDepartmentInput.value;
            departmentRefInputs.forEach(input => {
                input.value = departmentValue;
            });
        };

        if (mainDepartmentInput) {
            syncDepartmentFields(); 
            mainDepartmentInput.addEventListener('input', syncDepartmentFields);
        }
        
        // --- State Management Constants ---
        const STATES_OK_DEF = ['OK', 'N/A', 'DEF'];
        const STATES_Y_N = ['Y', 'N/A', 'N'];
        
        // --- FIX 1: Correctly locate the notification span ---
        // It's a sibling of the switch, not a child. We find the parent `switch-cell` first.
        const updateVisualState = (switchContainer, checkedValue) => {
            const cell = switchContainer.closest('.switch-cell');
            const notification = cell ? cell.querySelector('.unselected-notification') : null;
            
            if (notification) {
                // Only show notification if the N/A state is selected
                notification.style.opacity = (checkedValue === 'N/A') ? 1 : 0;
            }
        };

        // --- Switch Initialization and Logic (3-State with Dbl-Click) ---
        const toggleSwitches = document.querySelectorAll('.toggle-switch.three-state');

        toggleSwitches.forEach(switchContainer => {
            const name = switchContainer.dataset.name;
            const isYN = switchContainer.classList.contains('y-n-switch');
            const STATES = isYN ? STATES_Y_N : STATES_OK_DEF;

            const inputs = {};
            STATES.forEach(state => {
                const input = switchContainer.querySelector(`input[name="${name}"][value="${state}"]`);
                if (input) inputs[state] = input;
            });

            // Initialize Default State (Select N/A if nothing is checked)
            let checkedInput = Object.values(inputs).find(input => input.checked);
            if (!checkedInput && inputs['N/A']) {
                 inputs['N/A'].checked = true;
                 checkedInput = inputs['N/A'];
            }
            if (checkedInput) {
                updateVisualState(switchContainer, checkedInput.value);
            }

            // --- FIX 2: Simplify the click handler to reliably cycle through states ---
            switchContainer.addEventListener('click', (e) => {
                e.preventDefault(); // Always prevent default behavior to take full control

                // 1. Find the currently checked radio button
                let currentValue = null;
                for (const state of STATES) {
                    if (inputs[state] && inputs[state].checked) {
                        currentValue = state;
                        break;
                    }
                }

                // 2. Determine the next state in the cycle
                const currentIndex = currentValue ? STATES.indexOf(currentValue) : -1;
                const nextIndex = (currentIndex + 1) % STATES.length;
                const nextStateValue = STATES[nextIndex];

                // 3. Check the next radio button and update the UI
                const nextInput = inputs[nextStateValue];
                if (nextInput) {
                    nextInput.checked = true;
                    updateVisualState(switchContainer, nextStateValue);
                }
            });
        });

        // --- PRE-FILL DATA (EDIT MODE) ---
        if (window.savedFormData) {
            const data = window.savedFormData;
            Object.keys(data).forEach(key => {
                const element = form.elements[key];

                // 1. Handle simple input fields (text, date, number, etc.)
                if (element && typeof element.value !== 'undefined' && typeof data[key] === 'string') {
                    // This handles top-level fields like 'date', 'department', etc.
                    if (element.type === 'radio') {
                         const radioToSelect = form.querySelector(`input[name="${key}"][value="${data[key]}"]`);
                         if (radioToSelect) radioToSelect.checked = true;
                    } else {
                        element.value = data[key];
                    }
                }
                
                // 2. Handle complex checklist item objects { Status, Arr, ... }
                else if (data[key] && typeof data[key] === 'object') {
                    // Check for Status (OK/DEF/N/A or Y/N)
                    if (data[key].Status) {
                        const radio = form.querySelector(`input[name="${key}"][value="${data[key].Status}"]`);
                        if (radio) {
                            radio.checked = true;
                            // --- FIX 3: Update visual state after pre-filling data ---
                            const container = radio.closest('.toggle-switch');
                            if (container) updateVisualState(container, data[key].Status);
                        }
                    }
                    // Check for Arrival time
                    if (data[key].Arr) {
                        const timeInput = form.querySelector(`input[name="${key}_Arr"]`);
                        if (timeInput) timeInput.value = data[key].Arr;
                    }
                }
            });
            // Sync department refs after filling main input
            if (mainDepartmentInput) syncDepartmentFields();
        }


        // 4. Handle Form Submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            messageArea.textContent = 'Submitting...';

            const formData = new FormData(form);
            const data = {};
            
            for (const [key, value] of formData.entries()) {
                if (key.endsWith('_Dep_Ref')) continue;

                const parts = key.split('_');
                const suffix = parts[parts.length - 1];
                const isArr = suffix === 'Arr';
                const baseKey = isArr ? parts.slice(0, -1).join('_') : key;

                if (isArr) {
                    data[baseKey] = data[baseKey] || {};
                    data[baseKey].Arr = value;
                } else if (STATES_OK_DEF.includes(value) || STATES_Y_N.includes(value)) {
                    data[baseKey] = data[baseKey] || {};
                    data[baseKey].Status = value;
                } else {
                    data[key] = value;
                }
            }

            console.log('Data to be sent:', data);

            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    messageArea.textContent = `Success! ${result.message}`;
                    if(result.redirectUrl) {
                        setTimeout(() => window.location.href = result.redirectUrl, 1500);
                    }
                } else {
                    const result = await response.json();
                    messageArea.textContent = `Error: ${result.message || 'Submission failed.'}`;
                }
            } catch (error) {
                console.error('Submission failed:', error);
                messageArea.textContent = 'Network error. Submission failed.';
            }
        });
    });
    </script>
</div>